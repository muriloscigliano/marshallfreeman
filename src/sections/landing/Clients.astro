---
import { landingData } from '@data/landing';

const { clients } = landingData;
---

<section class="clients" aria-labelledby="clients-headline">
  <div class="clients__container container">
    <header class="clients__header">
      <h2 id="clients-headline" class="clients__headline">{clients.headline} <span class="clients__headline-muted">{clients.headlineMuted}</span></h2>
      <p class="clients__tagline">{clients.tagline}</p>
    </header>

    <ul class="clients__grid" role="list" aria-label="Industries we serve">
      {clients.items.map((client) => (
        <li class="clients__card" data-direction-aware>
          <!-- Default content (light text on dark bg) -->
          <article class="clients__card-content">
            <h3 class="clients__industry">{client.industry}</h3>
            <p class="clients__description">{client.description}</p>
          </article>
          <!-- Hover content (dark text) - clipped with highlight -->
          <div class="clients__card-highlight" aria-hidden="true">
            <article class="clients__card-content clients__card-content--hover">
              <h3 class="clients__industry">{client.industry}</h3>
              <p class="clients__description">{client.description}</p>
            </article>
          </div>
        </li>
      ))}
    </ul>
  </div>
</section>

<style>
  .clients {
    padding-block: var(--space-section);
    background: var(--color-text);
    color: var(--color-background);
  }

  .clients__container {
    display: flex;
    flex-direction: column;
    gap: var(--space-3xl);
  }

  .clients__header {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  @media (min-width: 1024px) {
    .clients__header {
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-end;
      gap: var(--space-2xl);
    }
  }

  .clients__headline {
    font-size: var(--text-5xl);
    font-weight: var(--font-weight-medium);
    letter-spacing: -0.03em;
    color: var(--color-background);
  }

  .clients__headline-muted {
    color: rgba(254, 255, 243, 0.4);
  }

  .clients__tagline {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--text-xs);
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: rgba(254, 255, 243, 0.5);
  }

  .clients__tagline::before {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--color-accent);
    border-radius: 50%;
  }

  .clients__grid {
    display: flex;
    flex-wrap: wrap;
    border: 1px solid rgba(254, 255, 243, 0.15);
  }

  .clients__card {
    position: relative;
    flex: 1 1 100%;
    border: 1px solid rgba(254, 255, 243, 0.15);
    margin: -1px;
    overflow: hidden;
  }

  /* Direction-aware highlight */
  .clients__card-highlight {
    position: absolute;
    inset: 8px;
    border-radius: 4px;
    background: var(--color-yellow-900);
    pointer-events: none;
    z-index: 2;
    clip-path: inset(0 100% 0 0);
    transition: clip-path 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
  }

  @media (max-width: 479px) {
    .clients__card-highlight {
      display: none;
    }
  }

  @media (min-width: 480px) {
    .clients__card {
      flex: 1 1 50%;
    }
  }

  @media (min-width: 1024px) {
    .clients__card {
      flex: 1 1 25%;
    }
  }

  .clients__card-content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    padding: var(--space-lg);
    min-height: 160px;
  }

  /* Hover content inside highlight - offset to align with original */
  .clients__card-content--hover {
    position: absolute;
    top: -8px;
    left: -8px;
    right: -8px;
    bottom: -8px;
    z-index: 3;
  }

  .clients__card-content--hover .clients__industry,
  .clients__card-content--hover .clients__description {
    color: var(--color-blue-900);
  }

  @media (min-width: 768px) {
    .clients__card-content {
      padding: var(--space-xl);
      gap: var(--space-md);
      min-height: 350px;
        justify-content: center;
    }
  }

  .clients__industry {
    font-size: var(--text-lg);
    font-weight: var(--font-weight-medium);
  }

  .clients__description {
    font-size: var(--text-sm);
    line-height: 1.6;
    color: rgba(254, 255, 243, 0.6);
  }

  .clients__link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: var(--text-sm);
    font-weight: var(--font-weight-semibold);
    color: var(--color-blue-900);
    transition: gap var(--duration-fast) var(--ease-out-expo);
  }

  .clients__link:hover {
    gap: var(--space-sm);
  }
</style>

<script>
  function initClientsDirectionAwareHover() {
    const cards = document.querySelectorAll('.clients__card[data-direction-aware]');

    cards.forEach((card) => {
      const highlight = card.querySelector('.clients__card-highlight') as HTMLElement;
      if (!highlight) return;

      // Get direction based on which edge the mouse crossed
      const getDirection = (e: MouseEvent, rect: DOMRect): string => {
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Calculate distances to each edge
        const distTop = y;
        const distBottom = rect.height - y;
        const distLeft = x;
        const distRight = rect.width - x;

        const minDist = Math.min(distTop, distBottom, distLeft, distRight);

        if (minDist === distTop) return 'top';
        if (minDist === distBottom) return 'bottom';
        if (minDist === distLeft) return 'left';
        return 'right';
      };

      // clip-path: inset(top right bottom left)
      // Get clip-path for hidden state based on direction (reveals from that edge)
      const getHiddenClipPath = (direction: string): string => {
        switch (direction) {
          case 'top': return 'inset(0 0 100% 0)';    // clipped at bottom, reveals from top
          case 'bottom': return 'inset(100% 0 0 0)'; // clipped at top, reveals from bottom
          case 'left': return 'inset(0 100% 0 0)';   // clipped at right, reveals from left
          case 'right': return 'inset(0 0 0 100%)';  // clipped at left, reveals from right
          default: return 'inset(0 100% 0 0)';
        }
      };

      card.addEventListener('mouseenter', (e) => {
        const rect = card.getBoundingClientRect();
        const direction = getDirection(e as MouseEvent, rect);

        // Set starting clip-path instantly (hidden)
        highlight.style.transition = 'none';
        highlight.style.clipPath = getHiddenClipPath(direction);

        // Force reflow
        highlight.offsetHeight;

        // Animate to fully visible
        highlight.style.transition = 'clip-path 0.35s cubic-bezier(0.4, 0, 0.2, 1)';
        highlight.style.clipPath = 'inset(0 0 0 0)';
      });

      card.addEventListener('mouseleave', (e) => {
        const rect = card.getBoundingClientRect();
        const direction = getDirection(e as MouseEvent, rect);

        // Animate out in the exit direction
        highlight.style.transition = 'clip-path 0.35s cubic-bezier(0.4, 0, 0.2, 1)';
        highlight.style.clipPath = getHiddenClipPath(direction);
      });
    });
  }

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initClientsDirectionAwareHover);
  } else {
    initClientsDirectionAwareHover();
  }

  document.addEventListener('astro:page-load', initClientsDirectionAwareHover);
</script>
