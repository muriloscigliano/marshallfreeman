---
import { landingData } from '@data/landing';

const { faq } = landingData;
---

<section id={faq.id} class="faq" aria-labelledby="faq-headline">
  <div class="faq__container container">
    <div class="faq__layout">
      <header class="faq__header">
        <p class="faq__tagline">{faq.tagline}</p>
        <h2 id="faq-headline" class="faq__headline">{faq.headline} <span class="faq__headline-muted">{faq.headlineMuted}</span></h2>
      </header>

      <dl class="faq__list" role="list" aria-label="Frequently asked questions">
        {faq.items.map((item, index) => (
          <div class="faq__item" role="listitem">
            <dt class="faq__question">
              <button
                type="button"
                class="faq__trigger"
                aria-expanded="false"
                aria-controls={`faq-answer-${index}`}
                data-faq-trigger
              >
                <span class="faq__number" aria-hidden="true">
                  {String(index + 1).padStart(2, '0')}
                </span>
                <span class="faq__question-text">{item.question}</span>
                <span class="faq__icon" aria-hidden="true">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <line x1="12" y1="5" x2="12" y2="19" class="faq__icon-vertical" />
                    <line x1="5" y1="12" x2="19" y2="12" />
                  </svg>
                </span>
              </button>
            </dt>
            <dd id={`faq-answer-${index}`} class="faq__answer" data-faq-answer>
              <div class="faq__answer-inner">
                <p class="faq__answer-text">{item.answer}</p>
              </div>
            </dd>
          </div>
        ))}
      </dl>
    </div>
  </div>
</section>

<style>
  .faq {
    padding-block: var(--space-section);
    background: var(--color-foreground);
  }

  .faq__container {
    display: flex;
    flex-direction: column;
  }

  .faq__layout {
    display: flex;
    flex-direction: column;
    gap: var(--space-2xl);
  }

  @media (min-width: 1024px) {
    .faq__layout {
      flex-direction: row;
      gap: var(--space-3xl);
    }
  }

  .faq__header {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  @media (min-width: 1024px) {
    .faq__header {
      flex: 1;
    }
  }

  .faq__tagline {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--text-xs);
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-text-subtle);
  }

  .faq__tagline::before {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--color-accent);
    border-radius: 50%;
  }

  .faq__headline {
    font-size: var(--text-5xl);
    font-weight: var(--font-weight-medium);
    letter-spacing: -0.03em;
    line-height: 1.1;
  }

  .faq__headline-muted {
    color: var(--color-text-muted);
  }

  .faq__list {
    display: flex;
    flex-direction: column;
    width: 100%;
  }

  @media (min-width: 1024px) {
    .faq__list {
      flex: 1.5;
    }
  }

  .faq__item {
    border-bottom: 1px solid var(--color-border);
  }

  .faq__item:first-child {
    border-top: 1px solid var(--color-border);
  }

  .faq__trigger {
    width: 100%;
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    padding-block: var(--space-lg);
    text-align: left;
    cursor: pointer;
  }

  .faq__number {
    font-size: var(--text-sm);
    font-weight: var(--font-weight-semibold);
    color: var(--color-accent);
    flex-shrink: 0;
    min-width: 2.5ch;
  }

  .faq__question-text {
    flex: 1;
    font-size: var(--text-base);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    transition: color var(--duration-base) var(--ease-out-expo);
  }

  .faq__trigger:hover .faq__question-text {
    color: var(--color-accent);
  }

  .faq__icon {
    flex-shrink: 0;
    color: var(--color-text-muted);
    transition: transform var(--duration-slow) var(--ease-out-expo);
  }

  .faq__icon-vertical {
    transition: transform var(--duration-slow) var(--ease-out-expo);
    transform-origin: center;
  }

  .faq__trigger[aria-expanded='true'] .faq__icon-vertical {
    transform: scaleY(0);
  }

  /* Smooth accordion animation */
  .faq__answer {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows var(--duration-slow) var(--ease-out-expo);
    overflow: hidden;
  }

  .faq__answer[data-expanded='true'] {
    grid-template-rows: 1fr;
  }

  .faq__answer-inner {
    overflow: hidden;
  }

  .faq__answer-text {
    font-size: var(--text-base);
    color: var(--color-text-muted);
    line-height: 1.7;
    padding-bottom: var(--space-lg);
    padding-left: calc(var(--space-lg) + 2.5ch);
    opacity: 0;
    transform: translateY(-8px);
    transition:
      opacity var(--duration-base) var(--ease-out-expo),
      transform var(--duration-base) var(--ease-out-expo);
    transition-delay: 0ms;
    max-width: 55ch;
  }

  .faq__answer[data-expanded='true'] .faq__answer-text {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 150ms;
  }
</style>

<script>
  const triggers = document.querySelectorAll('[data-faq-trigger]');

  triggers.forEach((trigger) => {
    trigger.addEventListener('click', () => {
      const isExpanded = trigger.getAttribute('aria-expanded') === 'true';
      const answerId = trigger.getAttribute('aria-controls');
      const answer = document.getElementById(answerId || '');

      // Close all other FAQs with smooth animation
      triggers.forEach((otherTrigger) => {
        if (otherTrigger !== trigger) {
          otherTrigger.setAttribute('aria-expanded', 'false');
          const otherAnswerId = otherTrigger.getAttribute('aria-controls');
          const otherAnswer = document.getElementById(otherAnswerId || '');
          if (otherAnswer) {
            otherAnswer.removeAttribute('data-expanded');
          }
        }
      });

      // Toggle current FAQ with smooth animation
      trigger.setAttribute('aria-expanded', String(!isExpanded));
      if (answer) {
        if (!isExpanded) {
          answer.setAttribute('data-expanded', 'true');
        } else {
          answer.removeAttribute('data-expanded');
        }
      }
    });
  });
</script>
