---
import { landingData } from '@data/landing';

const { testimonials } = landingData;
---

<section class="testimonials" aria-labelledby="testimonials-headline">
  <div class="testimonials__container container">
    <header class="testimonials__header">
      <p class="testimonials__tagline">{testimonials.tagline}</p>
      <h2 id="testimonials-headline" class="testimonials__headline">{testimonials.headline} <span class="testimonials__headline-muted">{testimonials.headlineMuted}</span></h2>
    </header>

    <!-- Overlapping Slider -->
    <div data-overlap-slider-init data-scale="0.45" data-rotate="-8" class="testimonials__slider-wrap">
      <div data-overlap-slider-collection class="testimonials__slider-collection">
        <div data-overlap-slider-list class="testimonials__slider-list">
          {testimonials.items.map((testimonial, index) => (
            <div data-overlap-slider-item class="testimonials__slider-item">
              <article class="testimonials__card" data-testimonial-card data-testimonial-index={index}>
                <div class="testimonials__card-inner">
                  <div class="testimonials__card-quote-icon" aria-hidden="true">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M11.192 15.757c0-.88-.23-1.618-.69-2.217-.326-.412-.768-.683-1.327-.812-.55-.128-1.07-.137-1.54-.028-.16-.95.1-1.956.76-3.022.66-1.065 1.515-1.867 2.558-2.403L9.373 5c-.8.396-1.56.898-2.26 1.505-.71.607-1.34 1.305-1.9 2.094s-.98 1.68-1.25 2.69-.346 2.04-.217 3.1c.168 1.4.62 2.52 1.356 3.35.735.84 1.652 1.26 2.748 1.26.965 0 1.766-.29 2.4-.878.628-.576.94-1.365.94-2.368l.002.003zm9.124 0c0-.88-.23-1.618-.69-2.217-.326-.42-.77-.692-1.327-.817-.56-.124-1.074-.13-1.54-.022-.16-.94.09-1.95.75-3.02.66-1.06 1.514-1.86 2.557-2.4L18.49 5c-.8.396-1.555.898-2.26 1.505-.708.607-1.34 1.305-1.894 2.094-.556.79-.97 1.68-1.24 2.69-.273 1-.345 2.04-.217 3.1.165 1.4.615 2.52 1.35 3.35.732.833 1.646 1.25 2.742 1.25.967 0 1.768-.29 2.402-.876.627-.576.942-1.365.942-2.368v.01z"/>
                    </svg>
                  </div>
                  <blockquote class="testimonials__card-quote">
                    <p>{testimonial.quote}</p>
                  </blockquote>
                  <footer class="testimonials__card-footer">
                    <div class="testimonials__card-avatar">
                      <svg xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 28 28" fill="none" class="testimonials__card-avatar-icon">
                        <path d="M13.9987 13.4168C16.576 13.4168 18.6654 11.3275 18.6654 8.75016C18.6654 6.17283 16.576 4.0835 13.9987 4.0835C11.4214 4.0835 9.33203 6.17283 9.33203 8.75016C9.33203 11.3275 11.4214 13.4168 13.9987 13.4168Z" stroke="currentColor" stroke-width="1.5"></path>
                        <path d="M5.25 24.5002V20.6619C5.25 20.1315 5.46071 19.6228 5.83579 19.2477L7.87597 17.2075C8.41163 16.6719 9.20397 16.4848 9.92264 16.7244L13.3675 17.8727C13.7781 18.0095 14.2219 18.0095 14.6325 17.8727L18.0774 16.7244C18.796 16.4848 19.5884 16.6719 20.124 17.2075L22.1642 19.2477C22.5393 19.6228 22.75 20.1315 22.75 20.6619V24.5002" stroke="currentColor" stroke-width="1.5"></path>
                      </svg>
                    </div>
                    <cite class="testimonials__card-author">{testimonial.author}</cite>
                  </footer>
                </div>
              </article>
            </div>
          ))}
        </div>
      </div>

      <!-- Navigation Arrows -->
      <div class="testimonials__nav">
        <button data-overlap-slider-prev class="testimonials__nav-btn testimonials__nav-btn--prev" aria-label="Previous testimonial">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5"/>
            <path d="m12 19-7-7 7-7"/>
          </svg>
        </button>
        <button data-overlap-slider-next class="testimonials__nav-btn testimonials__nav-btn--next" aria-label="Next testimonial">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14"/>
            <path d="m12 5 7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>

    <footer class="testimonials__footer">
      <p class="testimonials__industries">{testimonials.industries}</p>

      <div class="testimonials__trust">
        <div class="testimonials__avatars" aria-hidden="true">
          <span class="testimonials__avatar"></span>
          <span class="testimonials__avatar"></span>
          <span class="testimonials__avatar"></span>
          <span class="testimonials__avatar"></span>
        </div>
        <div class="testimonials__rating">
          <div class="testimonials__stars" aria-label="5 out of 5 stars">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
          </div>
          <span class="testimonials__rating-text">4.4 from 1,000+ Google reviews</span>
        </div>
      </div>
    </footer>
  </div>
</section>

<style>
  .testimonials {
    padding-block: var(--space-section);
    border-top: 1px solid var(--color-border);
    overflow: hidden;
  }

  .testimonials__container {
    display: flex;
    flex-direction: column;
    gap: var(--space-3xl);
  }

  .testimonials__header {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }

  .testimonials__tagline {
    font-size: var(--text-xs);
    font-weight: var(--font-weight-medium);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-text-subtle);
    max-width: none;
  }

  .testimonials__headline {
    font-size: var(--text-5xl);
    font-weight: var(--font-weight-medium);
    letter-spacing: -0.03em;
    line-height: 1.1;
  }

  .testimonials__headline-muted {
    color: var(--color-text-muted);
  }

  /* Overlapping Slider Styles */
  .testimonials__slider-wrap {
    width: 100%;
    margin-left: calc(var(--container-padding) * -1);
    padding-left: var(--container-padding);
  }

  .testimonials__slider-collection {
    justify-content: flex-start;
    align-items: flex-start;
    width: 100%;
    display: flex;
    position: relative;
  }

  .testimonials__slider-list {
    flex-flow: row;
    flex: none;
    justify-content: flex-start;
    align-items: center;
    display: flex;
    position: relative;
    cursor: grab;
  }

  .testimonials__slider-list:active {
    cursor: grabbing;
  }

  .testimonials__slider-item {
    flex: none;
    margin-right: 1.5rem;
  }

  /* Card Design */
  .testimonials__card {
    aspect-ratio: 3 / 4;
    background: linear-gradient(145deg, var(--color-blue-900) 0%, #032d50 100%);
    border-radius: 6px;
    width: 22rem;
    max-width: 85vw;
    position: relative;
    overflow: hidden;
    opacity: 0;
    transform: translateY(50px) scale(0.96);
    transition:
      opacity 0.9s cubic-bezier(0.22, 1, 0.36, 1),
      transform 1s cubic-bezier(0.22, 1, 0.36, 1);
  }

  .testimonials__card.is-revealed {
    opacity: 1;
    transform: translateY(0) scale(1);
  }

  .testimonials__card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      180deg,
      rgba(239, 244, 140, 0.08) 0%,
      transparent 40%
    );
    pointer-events: none;
  }

  .testimonials__card-inner {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
    padding: 2rem 1.75rem;
    position: relative;
    z-index: 1;
  }

  .testimonials__card-quote-icon {
    color: var(--color-yellow-900);
    opacity: 0.6;
    margin-bottom: 1rem;
  }

  .testimonials__card-quote {
    flex: 1;
    display: flex;
    align-items: flex-start;
  }

  .testimonials__card-quote p {
    font-size: var(--text-lg);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
    color: var(--color-yellow-300);
    max-width: none;
    margin: 0;
  }

  .testimonials__card-footer {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(254, 255, 243, 0.1);
  }

  .testimonials__card-avatar {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    background: var(--color-yellow-900);
    color: var(--color-blue-900);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    flex-shrink: 0;
  }

  .testimonials__card-avatar-icon {
    width: 100%;
    height: 100%;
  }

  .testimonials__card-author {
    font-size: var(--text-base);
    font-weight: var(--font-weight-semibold);
    font-style: normal;
    color: var(--color-yellow-300);
    line-height: 1.2;
  }

  .testimonials__footer {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
    padding-top: var(--space-xl);
    border-top: 1px solid var(--color-border);
  }

  @media (min-width: 768px) {
    .testimonials__footer {
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }
  }

  .testimonials__industries {
    font-size: var(--text-sm);
    color: var(--color-text-subtle);
    max-width: none;
  }

  /* Trust Badge */
  .testimonials__trust {
    display: flex;
    align-items: center;
    gap: var(--space-md);
  }

  .testimonials__avatars {
    display: flex;
  }

  .testimonials__avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--color-foreground);
    border: 2px solid var(--color-background);
    margin-left: -10px;
    position: relative;
  }

  .testimonials__avatar:first-child {
    margin-left: 0;
  }

  .testimonials__avatar:nth-child(1) { background: var(--color-blue-900); z-index: 4; }
  .testimonials__avatar:nth-child(2) { background: #1a4a6e; z-index: 3; }
  .testimonials__avatar:nth-child(3) { background: #2d5a7b; z-index: 2; }
  .testimonials__avatar:nth-child(4) { background: var(--color-yellow-900); z-index: 1; }

  .testimonials__rating {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .testimonials__stars {
    display: flex;
    gap: 2px;
    color: var(--color-yellow-900);
  }

  .testimonials__rating-text {
    font-size: var(--text-xs);
    font-weight: var(--font-weight-medium);
    color: var(--color-text-muted);
  }

  /* Navigation Arrows */
  .testimonials__nav {
    display: flex;
    gap: 0.75rem;
    margin-top: var(--space-xl);
  }

  .testimonials__nav-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    background: var(--color-yellow-500);
    border: 1px solid var(--color-yellow-700);
    color: var(--color-text);
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .testimonials__nav-btn:hover {
    background: var(--color-yellow-900);
    color: var(--color-blue-900);
    border-color: var(--color-yellow-900);
  }

  .testimonials__nav-btn:active {
    transform: scale(0.95);
  }

  .testimonials__nav-btn svg {
    width: 1.25rem;
    height: 1.25rem;
  }

  /* Mobile adjustments */
  @media (max-width: 640px) {
    .testimonials__card {
      width: 18rem;
    }

    .testimonials__card-quote p {
      font-size: var(--text-base);
    }

    .testimonials__nav-btn {
      width: 2.5rem;
      height: 2.5rem;
    }

    .testimonials__nav-btn svg {
      width: 1rem;
      height: 1rem;
    }
  }
</style>

<script>
  function initTestimonialReveal() {
    const cards = document.querySelectorAll('[data-testimonial-card]');
    if (!cards.length) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const card = entry.target as HTMLElement;
            const index = parseInt(card.dataset.testimonialIndex || '0', 10);
            // Stagger delay: 150ms between each card for smoother cascade
            const delay = Math.min(index, 4) * 150;

            setTimeout(() => {
              card.classList.add('is-revealed');
            }, delay);

            observer.unobserve(card);
          }
        });
      },
      { threshold: 0.15, rootMargin: '0px 0px -30px 0px' }
    );

    cards.forEach((card) => observer.observe(card));
  }

  // Initialize on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTestimonialReveal);
  } else {
    initTestimonialReveal();
  }

  // Re-init on Astro page transitions
  document.addEventListener('astro:page-load', initTestimonialReveal);
</script>
